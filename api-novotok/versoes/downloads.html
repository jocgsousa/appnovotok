<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovoTok - Downloads</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            padding: 20px;
        }
        .header {
            background-color: #dc3545;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .card {
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .download-btn {
            width: 100%;
        }
        .version-badge {
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
        .error {
            color: #dc3545;
            padding: 20px;
            text-align: center;
            background-color: #f8d7da;
            border-radius: 5px;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>NovoTok - Download</h1>
            <p>Baixe a versão mais recente do aplicativo NovoTok</p>
        </div>

        <div id="loading" class="loading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-2">Carregando versões disponíveis...</p>
        </div>

        <div id="error" class="error" style="display: none;">
            <p>Ocorreu um erro ao carregar as versões disponíveis. Por favor, tente novamente mais tarde.</p>
        </div>

        <div id="versoes-container" class="row" style="display: none;">
            <!-- As versões serão inseridas aqui dinamicamente -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const versoesContainer = document.getElementById('versoes-container');
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error');

            // Função para formatar a data
            function formatarData(dataString) {
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }

            // Função para criar o card de uma versão
            function criarCardVersao(versao) {
                const dataFormatada = formatarData(versao.modified);
                
                return `
                    <div class="col-md-6 col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">NovoTok</h5>
                                <span class="badge bg-danger version-badge">Versão ${versao.version}</span>
                                <p class="card-text">
                                    <strong>Tamanho:</strong> ${versao.size_formatted}<br>
                                    <strong>Atualizado em:</strong> ${dataFormatada}
                                </p>
                                <a href="${versao.download_url}" class="btn btn-success download-btn" download>
                                    <i class="bi bi-download"></i> Baixar APK
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Carregar as versões disponíveis
            fetch('index.php')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Erro ao carregar as versões');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success && data.files && data.files.length > 0) {
                        // Ordenar as versões por data de modificação (mais recente primeiro)
                        const versoes = data.files.sort((a, b) => {
                            return new Date(b.modified) - new Date(a.modified);
                        });

                        // Criar os cards para cada versão
                        let html = '';
                        versoes.forEach(versao => {
                            html += criarCardVersao(versao);
                        });

                        versoesContainer.innerHTML = html;
                        versoesContainer.style.display = 'flex';
                        loadingElement.style.display = 'none';
                    } else {
                        // Nenhuma versão encontrada
                        versoesContainer.innerHTML = `
                            <div class="col-12">
                                <div class="alert alert-info text-center">
                                    Nenhuma versão disponível para download no momento.
                                </div>
                            </div>
                        `;
                        versoesContainer.style.display = 'flex';
                        loadingElement.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    loadingElement.style.display = 'none';
                    errorElement.style.display = 'block';
                });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</body>
</html> 